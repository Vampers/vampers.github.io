<!DOCTYPE HTML>
<html>

<head>
	<link rel="bookmark"  type="image/x-icon"  href="/img/logo_miccall.png"/>
	 <link rel="shortcut icon" href="/img/logo_miccall.png">
	
			
    <title>
    Shivy's Backyard
    </title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <link rel="stylesheet" href="/css/mic_main.css" />
    <link rel="stylesheet" href="/css/dropdownMenu.css" />
	
    <noscript>
        <link rel="stylesheet" href="/css/noscript.css" />
    </noscript>

			    <script src="/js/jquery.min.js"></script>
    <script src="/js/jquery.scrollex.min.js"></script>
    <script src="/js/jquery.scrolly.min.js"></script>
    <script src="/js/skel.min.js"></script>
    <script src="/js/util.js"></script>
    <script src="/js/main.js"></script>
    <script src="//fonts.gstatic.com/ea/timing/v1/mlfont.js" async></script>
	
<link rel="stylesheet" href="/css/prism.css" type="text/css"></head>
    
		
<!-- Layouts -->



<!--  代码渲染  -->
<link rel="stylesheet" href="/css/prism_coy.css" />
<link rel="stylesheet" href="/css/typo.css" />
<!-- 文章页 -->
<body class="is-loading">
    <!-- Wrapper 外包 s-->
    <div id="wrapper" class="fade-in">
        <!-- Intro 头部显示 s -->
        <!-- Intro 头部显示 e -->
        <!-- Header 头部logo start -->
        <header id="header">
    <a href="/" class="logo">Vous revoir</a>
</header>
        <!-- Nav 导航条 start -->
        <nav id="nav" class="special" >
            <ul class="menu links" >
			<!-- Homepage  主页  --> 
			<li >
	            <a href="/" rel="nofollow">Home</a>
	        </li>
			<!-- categories_name  分类   --> 
	        
	        <!-- archives  归档   --> 
	        
	        <li class="active">
	            <a href="#s1">Archive</a>
	                    <ul class="submenu">
	                        <li>
	                        <a class="archive-link" href="/archives/2018/07/">July 2018</a></li><li><a class="archive-link" href="/archives/2017/12/">December 2017</a>
	                    </ul>
	        </li>
	        
	        
		        <!-- Pages 自定义   -->
		        
		        <li>
		            <a href="/about/" title="About">
		                About
		            </a>
		        </li>
		        


            </ul>
            <!-- icons 图标   -->
			<ul class="icons">
		            
		                <li><a href="https://github.com/Vampers" class="icon fa-github"><span class="label">GitHub</span></a></li>
		            
		            
		            
		            
			</ul>
</nav>

        <div id="main" >
            <div class ="post_page_title_img" style="height: 25rem;background-image: url(https://res.cloudinary.com/ripple3710/image/upload/v1531477509/694920_erhnsx.jpg);background-position: center; background-repeat:no-repeat; background-size:cover;-moz-background-size:cover;overflow:hidden;" >
                <a href="#" style="padding: 4rem 4rem 2rem 4rem ;"><h2 >在VPS上部署BT离线下载</h2></a>
            </div>
            <!-- Post -->
            <div class="typo" style="padding: 3rem;">
                <h2 id="1-前言"><a href="#1-前言" class="headerlink" title="1. 前言"></a>1. 前言</h2><p>VPS 的网络出入口速率通常比较可观，因此可考虑在 VPS 上部署 BT 下载，从而提高效率。  </p>
<h2 id="2-VPS-的选择"><a href="#2-VPS-的选择" class="headerlink" title="2. VPS 的选择"></a>2. VPS 的选择</h2><p>由于需要部署BT，因此在选择VPS上需要注意以下几点：  </p>
<ul>
<li>硬盘容量需要足够大</li>
<li>VPS提供商允许BT，这点很重要，部分VPS提供商明令禁止在VPS上进行BT下载。在购买VPS前一定要仔细看看TOS（Terms of Service），看是否允许BT下载</li>
<li>如果是下载电影等有版权的东西，得要购买无视版权的VPS  </li>
</ul>
<p>这里可以考虑 <a href="https://www.ramnode.com/" target="_blank" rel="noopener">RamNode</a> 的VPS，RamNode 的 <code>Acceptable Use Policy</code> 中写有：  </p>
<blockquote>
<p>The following are acceptable uses provided they comply with the rest of this AUP:  </p>
<ul>
<li>IRC<sup>*</sup></li>
<li>Source games<sup>+</sup></li>
<li>Minecraft servers<sup>+</sup></li>
<li>VPN</li>
<li>Adult material</li>
<li>Video streaming</li>
<li>Torrents (Only allowed in US locations - must be limited to 20Mbps total)</li>
<li>Usenet (Must be limited to 20Mbps total)  </li>
</ul>
<p><sup>*</sup>Any usage which results in any attacks against RamNode the company (not just the client’s server) may result in suspension and/or termination.<br>  <sup>+</sup>Game servers are not allowed on Massive plans (CVZ and CKVM).  </p>
</blockquote>
<h2 id="3-建立本地端和-VPS-端的-SSH-连接"><a href="#3-建立本地端和-VPS-端的-SSH-连接" class="headerlink" title="3. 建立本地端和 VPS 端的 SSH 连接"></a>3. 建立本地端和 VPS 端的 SSH 连接</h2><p>首先，在本地端安装 SSH 工具，这类工具有很多，使用方法也大同小异。本文将以 <a href="http://www.netsarang.com/xshell_download.html" target="_blank" rel="noopener">Xshell</a> 为例进行操作。<br>在网页上登录你的 VPS 控制台，记录下 IP 地址，SSH 连接端口号，以及 root 用户的密码。如果是 RamNode 的 VPS ，那么有关 SSH 连接的信息会以邮件形式发送给用户。</p>
<ul>
<li>打开 Xshell，选择 <code>新建连接</code>，在 <code>Host</code> 一栏中填写 VPS 的 IP 地址，在 <code>Port Number</code> 一栏中填写 VPS 的 SSH 连接端口号，填好保存，建立连接。</li>
<li>连接过程中 Xshell 会弹框要求输入用户名和密码，用户名输入 <code>root</code>，密码输入你刚才记录的密码。</li>
<li><p>连接成功建立后，会在 Xshell 上显示:</p>
<blockquote>
<p>Connection established.<br>To escape to local shell, press ‘Ctrl+Alt+]’.<br>&nbsp;<br>Welcome to Ubuntu 16.04 LTS (GNU/Linux 2.6.32-042stab127.2 x86_64)  </p>
<ul>
<li>Documentation:  <a href="https://help.ubuntu.com/" target="_blank" rel="noopener">https://help.ubuntu.com/</a>  </li>
</ul>
<p>The programs included with the Ubuntu system are free software; the exact distribution terms for each program are described in the individual files in /usr/share/doc/*/copyright.<br>&nbsp;<br>Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by applicable law.<br>&nbsp;<br>root@happylife:~#  </p>
</blockquote>
</li>
</ul>
<h2 id="4-BT-软件安装"><a href="#4-BT-软件安装" class="headerlink" title="4. BT 软件安装"></a>4. BT 软件安装</h2><p>本文采用的 BT 客户端为 <code>Deluge</code> ，Deluge 提供了 Web-UI ，方便管理操作，VPS 操作系统为 Ubuntu 16.04 64bit。<br>Ubuntu 上使用 PPA 的方式安装:  </p>
<pre class=" language-bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> update
<span class="token function">apt-get</span> <span class="token function">install</span> software-properties-common
<span class="token function">sudo</span> add-apt-repository ppa:deluge-team/ppa
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> deluged deluge-web
</code></pre>
<p>其他 Linux 发行版本的安装方式可以参考<a href="https://dev.deluge-torrent.org/wiki/Download" target="_blank" rel="noopener">官方文档</a>，安装完成后执行以下命令启动 Deluge：  </p>
<pre class=" language-bash"><code class="language-bash">deluge-web --ssl -p 8080 <span class="token operator">&amp;</span>
</code></pre>
<p>这里 <code>--ssl</code> 指开启 ssl 访问，<code>8080</code> 是指访问端口，这时只需要访问 <code>https://VPS的IP地址:8080</code> 就可以看到 Deluge 的 web 管理界面了，Deluge 的默认密码为 <code>deluge</code> ，进入后记得及时修改密码。<br>然后连接 Deluge 服务：</p>
<p><div align="center"><img src="https://res.cloudinary.com/ripple3710/image/upload/v1531492737/deluge_iee2hp.png" alt="image"></div><br>至此，BT 服务端基本搭建完成，别忘了给 Deluge 的上传和下载限速 20Mbps。  </p>
<h2 id="5-Web-服务搭建"><a href="#5-Web-服务搭建" class="headerlink" title="5. Web 服务搭建"></a>5. Web 服务搭建</h2><p>BT 服务端搭建好之后便可随意下载种子了，剩下的问题就是下载到VPS的文件要怎么取回到本地。<br>最简单的方式便是在 VPS 上搭建一个 <code>http服务器</code> ，打开网页就可以看到下载好的文件，直接点击就可以下载。这样一来，从 BT 下载到文件的取回全都是通过 Web 服务操作，非常方便。<br>本文采用 <code>Lighttpd</code> 搭建 http 服务器。  </p>
<pre class=" language-bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> lighttpd
</code></pre>
<p>接下来，需要编辑 Lighttpd 的配置文件，使它以我们想要的方式运行，本文将介绍使用 <code>https + 密码验证</code> 的配置过程。  </p>
<h3 id="5-1-配置-https"><a href="#5-1-配置-https" class="headerlink" title="5.1 配置 https"></a>5.1 配置 https</h3><p><a href="https://letsencrypt.org/" target="_blank" rel="noopener">Let’s Encrypt</a> 是一个颁发免费 SSL/TLS 证书的证书颁发机构(CA)，可以使用它为 Lighttpd 配置 https。  </p>
<ol>
<li>安装 Certbot<pre class=" language-bash"><code class="language-bash">add-apt-repository ppa:certbot/certbot
<span class="token function">apt-get</span> update
<span class="token function">apt-get</span> <span class="token function">install</span> certbot
</code></pre>
</li>
<li>获取 SSL 证书<pre class=" language-bash"><code class="language-bash">certbot certonly -d example.com      //将 example.com 换成你自己的域名
</code></pre>
当看到以下内容时，选择 <code>1</code> :<blockquote>
<p>How would you like to authenticate with the ACME CA?<br>&nbsp;<br>1: Spin up a temporary webserver (standalone)<br>2: Place files in webroot directory (webroot)<br>&nbsp;<br>Select the appropriate number [1-2] then [enter] (press ‘c’ to cancel):  </p>
</blockquote>
</li>
</ol>
<blockquote>
<p>注：运行时如果遇到报错信息 <code>Problem binding to port 80: Could not bind to IPv4 or IPv6.</code> ，执行以下命令：</p>
<pre class=" language-bash"><code class="language-bash">  <span class="token function">sudo</span> /etc/init.d/apache2 stop
  <span class="token function">service</span> lighttpd stop
</code></pre>
</blockquote>
<ol>
<li>配置证书<br>上述步骤完成后，会在 <code>/etc/letsencrypt/live/example.com/</code> 生成证书，文件结构如下：<pre class=" language-text"><code class="language-text">/etc/letsencrypt/live/example.com/
|-- README
|-- cert.pem -> ../../archive/example.com/cert1.pem
|-- chain.pem -> ../../archive/example.com/chain1.pem
|-- fullchain.pem -> ../../archive/example.com/fullchain1.pem
|-- privkey.pem -> ../../archive/example.com/privkey1.pem
</code></pre>
在将证书应用于 Lighttpd 时，需要将 <code>cert.pem</code> 和 <code>privkey.pem</code> 合并：<pre class=" language-bash"><code class="language-bash"><span class="token function">cat</span> /etc/letsencrypt/live/example.com/cert.pem /etc/letsencrypt/live/example.com/privkey.pem <span class="token operator">></span> /etc/letsencrypt/live/example.com/merged.pem
</code></pre>
</li>
<li>证书更新<br>Let’s Encrypt SSL 证书，有效期为 90 天。因此需要在证书到期之前更新证书，以避免证书错误。可以用 Certbot 更新证书。<pre class=" language-bash"><code class="language-bash">certbot renew
</code></pre>
注意：每次证书更新后，需要重新合并 <code>cert.pem</code> 和 <code>privkey.pem</code> 。  <h3 id="5-2-配置-Lighttpd"><a href="#5-2-配置-Lighttpd" class="headerlink" title="5.2 配置 Lighttpd"></a>5.2 配置 Lighttpd</h3>修改 Lighttpd 的配置文件，使其在 <code>https + 密码验证</code> 的模式下运行：<pre class=" language-bash"><code class="language-bash"><span class="token function">vi</span> /etc/lighttpd/lighttpd.conf
</code></pre>
将配置文件修改为：<br>```nix<br>server.modules = (<pre><code> &quot;mod_access&quot;,
 &quot;mod_alias&quot;,
 &quot;mod_compress&quot;,
 &quot;mod_redirect&quot;,
</code></pre><h1 id="“mod-rewrite”"><a href="#“mod-rewrite”" class="headerlink" title="“mod_rewrite”,"></a>“mod_rewrite”,</h1><pre><code> &quot;mod_auth&quot;,
</code></pre>)<br>server.document-root        = “/var/www/“<br>server.upload-dirs          = ( “/var/cache/lighttpd/uploads” )<br>server.errorlog             = “/var/log/lighttpd/error.log”<br>server.pid-file             = “/var/run/lighttpd.pid”<br>server.username             = “www-data”<br>server.groupname            = “www-data”<h1 id="server-port-80"><a href="#server-port-80" class="headerlink" title="server.port                 = 80"></a>server.port                 = 80</h1><h1 id="server-bind-“0-0-0-0”"><a href="#server-bind-“0-0-0-0”" class="headerlink" title="server.bind               = “0.0.0.0”"></a>server.bind               = “0.0.0.0”</h1>server.dir-listing = “enable”<br>$SERVER[“socket”] == “0.0.0.0:443” {<pre><code> ssl.engine = &quot;enable&quot;
 ssl.pemfile = &quot;/etc/letsencrypt/live/example.com/ssl.pem&quot;
 ssl.ca-file = &quot;/etc/letsencrypt/live/example.com/fullchain.pem&quot;
 server.name = &quot;example.com&quot;
  }
</code></pre>$SERVER[“socket”] == “[::]:443” {<pre><code> ssl.engine = &quot;enable&quot;
 ssl.pemfile = &quot;/etc/letsencrypt/live/example.com/ssl.pem&quot;
 ssl.ca-file = &quot;/etc/letsencrypt/live/example.com/fullchain.pem&quot;
 server.name = &quot;example.com&quot;
  }
</code></pre><h1 id="http自动跳转到https"><a href="#http自动跳转到https" class="headerlink" title="http自动跳转到https"></a>http自动跳转到https</h1>$SERVER[“socket”] == “:80” {<br>$HTTP[“host”] =~ “.<em>“ {<br> url.redirect = (“.</em>“ =&gt; “<a href="https://%0$0" target="_blank" rel="noopener">https://%0$0</a>“)<br>}<br>}<br>$SERVER[“socket”] == “[::]:80” {<br>$HTTP[“host”] =~ “.<em>“ {<br> url.redirect = (“.</em>“ =&gt; “<a href="https://%0$0" target="_blank" rel="noopener">https://%0$0</a>“)<br>}<br>}<br>index-file.names            = ( “index.php”, “index.html”, “index.lighttpd.html” )<br>url.access-deny             = ( “~”, “.inc” )<br>static-file.exclude-extensions = ( “.php”, “.pl”, “.fcgi” )<br>compress.cache-dir          = “/var/cache/lighttpd/compress/“<br>compress.filetype           = ( “application/javascript”, “text/css”, “text/html”, “text/plain” )<h1 id="default-listening-port-for-IPv6-falls-back-to-the-IPv4-port"><a href="#default-listening-port-for-IPv6-falls-back-to-the-IPv4-port" class="headerlink" title="default listening port for IPv6 falls back to the IPv4 port"></a>default listening port for IPv6 falls back to the IPv4 port</h1><h2 id="Use-ipv6-if-available"><a href="#Use-ipv6-if-available" class="headerlink" title="Use ipv6 if available"></a>Use ipv6 if available</h2>#include_shell “/usr/share/lighttpd/use-ipv6.pl “ + server.port<br>include_shell “/usr/share/lighttpd/create-mime.assign.pl”<br>include_shell “/usr/share/lighttpd/include-conf-enabled.pl”<br>dir-listing.encoding       = “utf8”</li>
</ol>
<h1 id="开启密码认证，同时在最前面的server-modules中加入mod-auth"><a href="#开启密码认证，同时在最前面的server-modules中加入mod-auth" class="headerlink" title="开启密码认证，同时在最前面的server.modules中加入mod_auth"></a>开启密码认证，同时在最前面的server.modules中加入mod_auth</h1><h1 id="如果不需要密码认证，把下面的代码删除即可"><a href="#如果不需要密码认证，把下面的代码删除即可" class="headerlink" title="如果不需要密码认证，把下面的代码删除即可"></a>如果不需要密码认证，把下面的代码删除即可</h1><h1 id="关闭auth的debug模式"><a href="#关闭auth的debug模式" class="headerlink" title="关闭auth的debug模式"></a>关闭auth的debug模式</h1><p>auth.debug = 0</p>
<h1 id="使用明文密码，这是最简单的方式"><a href="#使用明文密码，这是最简单的方式" class="headerlink" title="使用明文密码，这是最简单的方式"></a>使用明文密码，这是最简单的方式</h1><p>auth.backend = “plain”</p>
<h1 id="定义用户名、密码存放的路径"><a href="#定义用户名、密码存放的路径" class="headerlink" title="定义用户名、密码存放的路径"></a>定义用户名、密码存放的路径</h1><p>auth.backend.plain.userfile = “/etc/lighttpd/auth”</p>
<h1 id="定义要加密的路径"><a href="#定义要加密的路径" class="headerlink" title="定义要加密的路径"></a>定义要加密的路径</h1><p>auth.require = ( “/“ =&gt;<br>(</p>
<h1 id="可以使用多种认证方式，这里以basic为例"><a href="#可以使用多种认证方式，这里以basic为例" class="headerlink" title="可以使用多种认证方式，这里以basic为例"></a>可以使用多种认证方式，这里以basic为例</h1><p>“method” =&gt; “basic”,</p>
<h1 id="访问时，对话框的提示信息"><a href="#访问时，对话框的提示信息" class="headerlink" title="访问时，对话框的提示信息"></a>访问时，对话框的提示信息</h1><p>“realm” =&gt; “Password protected area”,</p>
<h1 id="允许访问的用户名，用“-”号分割多个用户"><a href="#允许访问的用户名，用“-”号分割多个用户" class="headerlink" title="允许访问的用户名，用“|”号分割多个用户"></a>允许访问的用户名，用“|”号分割多个用户</h1><p>“require” =&gt; “user=username01|user=username02”<br>)<br>)</p>
<pre><code>密码认证文件位置为 `/etc/lighttpd/auth` ，格式为 `用户名:密码` ，例如：`root:admin`。  
完成配置后，重启 Lighttpd 服务：
```bash
service lighttpd restart
</code></pre><h3 id="5-3-BT-客户端适配"><a href="#5-3-BT-客户端适配" class="headerlink" title="5.3 BT 客户端适配"></a>5.3 BT 客户端适配</h3><p>配置 Deluge 下载路径为 <code>/var/www/</code> :</p>
<p><div align="center"><img src="https://res.cloudinary.com/ripple3710/image/upload/v1531505196/change_tp6nia.png" alt="image"></div><br>现在，访问 <code>https://你的域名</code> 即可下载 BT 下载完成的文件，enjoy！  </p>
<h5 id="完结撒花！"><a href="#完结撒花！" class="headerlink" title="完结撒花！"></a>完结撒花！</h5>
            </div>

            <!-- Post Comments -->
            

        </div>
        <!-- Copyright 版权 start -->
                <div id="copyright">
            <ul>
                <li>&copy;Powered By <a href="https://hexo.io/zh-cn/" style="border-bottom: none;">hexo</a></li>
                <li>Design: <a href="https://github.com/Vampers" style="border-bottom: none;">Shivy</a></li>
            </ul>
            
			    <span> 2018 </span> 
        </div>
    </div>
</body>



 	
</html>
